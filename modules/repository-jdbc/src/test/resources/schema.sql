-- Test schema for H2 database

-- User 테이블
CREATE TABLE IF NOT EXISTS USERS (
    USER_ID BIGINT AUTO_INCREMENT PRIMARY KEY,
    EMAIL VARCHAR(255) NOT NULL UNIQUE,
    NAME VARCHAR(255) NOT NULL,
    CREATED_AT TIMESTAMP(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
    UPDATED_AT TIMESTAMP(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6)
);

-- Coupon 테이블
CREATE TABLE IF NOT EXISTS COUPONS (
    COUPON_ID BIGINT AUTO_INCREMENT PRIMARY KEY,
    NAME VARCHAR(255) NOT NULL,
    DISCOUNT_AMOUNT INT NOT NULL,
    TOTAL_QUANTITY INT NOT NULL,
    ISSUED_COUNT INT NOT NULL DEFAULT 0,
    USER_ID BIGINT NOT NULL,
    START_DATE TIMESTAMP(6) NOT NULL,
    END_DATE TIMESTAMP(6) NOT NULL,
    CREATED_AT TIMESTAMP(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
    UPDATED_AT TIMESTAMP(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
    FOREIGN KEY (USER_ID) REFERENCES USERS(USER_ID)
);

-- CouponIssuance 테이블
CREATE TABLE IF NOT EXISTS COUPON_ISSUANCES (
    ISSUANCE_ID BIGINT AUTO_INCREMENT PRIMARY KEY,
    COUPON_ID BIGINT NOT NULL,
    USER_ID BIGINT NOT NULL,
    ISSUED_AT TIMESTAMP(6) NOT NULL,
    USED_AT TIMESTAMP(6),
    STATUS VARCHAR(50) NOT NULL,
    CREATED_AT TIMESTAMP(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
    UPDATED_AT TIMESTAMP(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),
    FOREIGN KEY (COUPON_ID) REFERENCES COUPONS(COUPON_ID),
    FOREIGN KEY (USER_ID) REFERENCES USERS(USER_ID),
    CONSTRAINT UK_COUPON_USER UNIQUE (COUPON_ID, USER_ID)
);
